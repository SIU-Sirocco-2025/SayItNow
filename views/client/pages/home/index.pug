extends ../../layouts/default.pug
include ../../mixins/moment.pug
include ../../mixins/aqi.pug
include ../../mixins/alert.pug
include ../../mixins/stats-grid.pug

block main
  +showAlertSuccess(5000)
  +showAlertError(5000)
  
  // Hero Breathing Section - Dark Theme with Animated Globe
  section.hero-breathing(id='hero-breathing', data-aqi-status='good')
    .hero-breathing__background
    
    // Particles background
    .hero-particles
      each i in [0,1,2,3,4,5,6,7,8,9,10,11,12]
        .particle
    
    // Main content
    .container.position-relative.z-1.py-5
      .row.align-items-center.gy-4
        // Left side - Globe with badges
        .col-lg-6.text-center
          // Animated Globe
          .hero-globe
            .globe-ring
            .globe-ring
            .globe-ring
            
            .globe-circle
              .globe-shield
              i.bi.bi-lungs.globe-icon
            
            // Floating badges
            .globe-badge.badge-aqi üåç
            .globe-badge.badge-leaf üçÉ
            .globe-badge.badge-wind üí®
        
        // Right side - Text and buttons
        .col-lg-6.hero-content
          .eco-track-label Eco
          h1.hero-title Track
          p.hero-subtitle H√¥m nay th√†nh ph·ªë ƒëang th·ªü nh∆∞ th·∫ø n√†o?
          
          // CTA Buttons
          .d-flex.gap-3.flex-wrap.mt-4
            a.btn-hero(href='#forecast', role='button')
              i.bi.bi-graph-up-arrow
              | D·ª± b√°o 24 gi·ªù t·ªõi
            a.btn-hero.btn-hero-secondary(href='/aqi', role='button')
              i.bi.bi-map
              | Xem b·∫£n ƒë·ªì AQI
      
      // Scroll indicator
      .scroll-indicator
        i.bi.bi-chevron-down

  // Air Quality Details Section
  .container.py-5#air
    h2.section-title Ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠ hi·ªán t·∫°i
    
    if reading
      // AQI Recommendation Card
      - const aqi = Number(reading.aqius) || 0
      - let recIcon, recMsg, recLevel
      
      if aqi <= 50
        - recIcon = 'bi-emoji-smile'
        - recMsg = 'Kh√¥ng kh√≠ t·ªët. B·∫°n c√≥ th·ªÉ ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng ngo√†i tr·ªùi.'
        - recLevel = 'good'
      else if aqi <= 100
        - recIcon = 'bi-emoji-neutral'
        - recMsg = 'Ch·∫•t l∆∞·ª£ng trung b√¨nh. Nh√≥m nh·∫°y c·∫£m n√™n h·∫°n ch·∫ø ti·∫øp x√∫c l√¢u ngo√†i tr·ªùi.'
        - recLevel = 'moderate'
      else if aqi <= 150
        - recIcon = 'bi-emoji-frown'
        - recMsg = 'Ng∆∞·ªùi nh·∫°y c·∫£m h·∫°n ch·∫ø v·∫≠n ƒë·ªông m·∫°nh ngo√†i tr·ªùi.'
        - recLevel = 'unhealthy-for-sensitive'
      else if aqi <= 200
        - recIcon = 'bi-exclamation-triangle'
        - recMsg = 'M·ªçi ng∆∞·ªùi n√™n h·∫°n ch·∫ø v·∫≠n ƒë·ªông m·∫°nh. Ng∆∞·ªùi nh·∫°y c·∫£m tr√°nh ho·∫°t ƒë·ªông ngo√†i tr·ªùi.'
        - recLevel = 'unhealthy'
      else if aqi <= 300
        - recIcon = 'bi-exclamation-triangle-fill'
        - recMsg = 'C·∫£nh b√°o: T·∫•t c·∫£ m·ªçi ng∆∞·ªùi n√™n tr√°nh ho·∫°t ƒë·ªông ngo√†i tr·ªùi. S·ª≠ d·ª•ng kh·∫©u trang N95.'
        - recLevel = 'very-unhealthy'
      else
        - recIcon = 'bi-exclamation-octagon'
        - recMsg = 'NGUY HI·ªÇM: M·ªçi ng∆∞·ªùi n√™n ·ªü trong nh√†. Ch·ªâ ra ngo√†i khi c·∫ßn thi·∫øt v·ªõi kh·∫©u trang N95.'
        - recLevel = 'hazardous'
      
      .recommendation-card(class='recommendation-' + recLevel)
        .recommendation-icon
          i(class='bi ' + recIcon)
        .recommendation-content
          .recommendation-text= recMsg
        .recommendation-bg
      
      // Stats Grid
      +statsGrid(reading)
    else
      .alert.alert-secondary.mb-0
        i.bi.bi-info-circle.me-2
        | Kh√¥ng c√≥ d·ªØ li·ªáu AQI hi·ªÉn th·ªã. Vui l√≤ng th·ª≠ l·∫°i sau.

  
  // Forecast Section
  .container.py-5#forecast
    h2.section-title D·ª± b√°o AQI 24 gi·ªù t·ªõi
    
    .card.border-0.shadow-sm
      .card-body
        .row.g-3.mb-4
          .col-md-6
            label.form-label
              i.bi.bi-map-pin.me-2
              | Ch·ªçn qu·∫≠n ƒë·ªÉ d·ª± b√°o
            select#district-select.form-select.form-select-lg
              option(value='') -- Ch·ªçn qu·∫≠n --
          
          .col-md-6.d-flex.align-items-end
            button#btn-forecast.btn.btn-lg.w-100(type='button', style='background: linear-gradient(135deg, #2d6a2d, #169444); color: white; border: none; font-weight: 600;')
              i.bi.bi-graph-up-arrow.me-2
              | Xem d·ª± b√°o
        
        // Loading State
        #forecast-loading.d-none
          .text-center.py-4
            .spinner-border.text-success.mb-3(role='status')
            p.text-muted ƒêang t·∫£i d·ªØ li·ªáu d·ª± b√°o...
        
        // Error State
        #forecast-error.alert.alert-danger.d-none(role='alert')
        
        // Results
        #forecast-result.d-none
          .row.g-3.mb-4
            .col-md-3
              .stat-card
                .stat-card__icon
                  i.bi.bi-geo-alt
                .stat-card__body
                  .stat-card__label Khu v·ª±c
                  .stat-card__value#forecast-district --
            .col-md-3
              .stat-card
                .stat-card__icon
                  i.bi.bi-bar-chart
                .stat-card__body
                  .stat-card__label AQI Trung b√¨nh
                  .stat-card__value#forecast-mean --
            .col-md-3
              .stat-card
                .stat-card__icon
                  i.bi.bi-arrow-up-circle
                .stat-card__body
                  .stat-card__label AQI Cao nh·∫•t
                  .stat-card__value#forecast-max --
            .col-md-3
              .stat-card
                .stat-card__icon
                  i.bi.bi-arrow-down-circle
                .stat-card__body
                  .stat-card__label AQI Th·∫•p nh·∫•t
                  .stat-card__value#forecast-min --
          
          .card.border-0
            .card-body
              h5.mb-3
                i.bi.bi-graph-up-arrow.me-2
                | Chi ti·∫øt 24 gi·ªù
              #forecast-chart.mb-3
              #forecast-table-container
  
  // Info Section  
  .container.py-5
    h2.section-title Th√¥ng tin AQI
    
    .row.g-4
      .col-md-6
        .card.border-0.shadow-sm
          .card-body.p-4
            h5.mb-3
              i.bi.bi-info-circle.me-2
              | Ch·ªâ s·ªë AQI l√† g√¨?
            p.text-muted.mb-0 AQI (Air Quality Index) l√† ch·ªâ s·ªë ƒëo l∆∞·ªùng ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠. Gi√° tr·ªã c√†ng cao, ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠ c√†ng t·ªá. Ch·ªâ s·ªë AQI ƒë∆∞·ª£c t√≠nh d·ª±a tr√™n n·ªìng ƒë·ªô c√°c ch·∫•t √¥ nhi·ªÖm nh∆∞ PM2.5, PM10, O3, NO2, SO2 v√† CO.
      
      .col-md-6
        .card.border-0.shadow-sm
          .card-body.p-4
            h5.mb-3
              i.bi.bi-shield-check.me-2
              | B·∫£ng ti√™u chu·∫©n AQI
            .small
              .d-flex.justify-content-between.mb-2
                span
                  span.badge.rounded-pill(style='background: #d4f1d4; color: #2d6a2d;') 0-50
                span.text-muted: small T·ªët
              .d-flex.justify-content-between.mb-2
                span
                  span.badge.rounded-pill(style='background: #fff8dd; color: #8b7a00;') 51-100
                span.text-muted: small Trung b√¨nh
              .d-flex.justify-content-between.mb-2
                span
                  span.badge.rounded-pill(style='background: #ffe8d1; color: #a64d0a;') 101-150
                span.text-muted: small Nh·∫°y c·∫£m
              .d-flex.justify-content-between.mb-2
                span
                  span.badge.rounded-pill(style='background: #ffd9d9; color: #8b0000;') 151-200
                span.text-muted: small Kh√¥ng l√†nh m·∫°nh
              .d-flex.justify-content-between.mb-2
                span
                  span.badge.rounded-pill(style='background: #e8d4f1; color: #5a2d6a;') 201-300
                span.text-muted: small R·∫•t kh√¥ng l√†nh m·∫°nh
              .d-flex.justify-content-between
                span
                  span.badge.rounded-pill(style='background: #ffcccc; color: #660000;') 300+
                span.text-muted: small Nguy hi·ªÉm