extends ../../layouts/auth.pug
include ../../mixins/alert.pug
include ../../mixins/auth-form.pug
include ../../mixins/auth-modal.pug
include ../../mixins/auth-brand.pug

block main
    +showAlertSuccess(5000)
    +showAlertError(5000)

    .register-page-wrapper.min-vh-100.d-flex.align-items-center.py-5
        .container
            .row.g-5.align-items-center
                //- Left brand / intro
                .col-lg-6.order-2.order-lg-1
                    - 
                        const features = [
                            { icon: 'check-circle-fill', text: 'Tài khoản miễn phí trọn đời' },
                            { icon: 'check-circle-fill', text: 'Truy cập đầy đủ dữ liệu AQI' },
                            { icon: 'check-circle-fill', text: 'Nhận cảnh báo chất lượng không khí' },
                            { icon: 'check-circle-fill', text: 'Lưu trữ lịch sử quan sát cá nhân' }
                        ];
                        const buttons = [
                            { class: 'btn btn-success btn-sm', href: '/', icon: 'house-door', text: 'Trang chủ' },
                            { class: 'btn btn-outline-success btn-sm', href: '/aqi', icon: 'map', text: 'Xem bản đồ AQI' }
                        ];
                    
                    +authBrandIntro(features, buttons)
                        | Tham gia cùng chúng tôi để theo dõi và bảo vệ chất lượng không khí TP. Hồ Chí Minh.

                //- Right form
                .col-lg-5.ms-lg-auto.order-1.order-lg-2
                    .card.border-0.shadow-lg.register-card
                        .card-body.p-4.p-md-5
                            +authCardHeader('person-plus-fill', 'Tạo tài khoản mới', 'Đăng ký để bắt đầu theo dõi')
                            
                            //- Google Register Button (thêm phần này)
                            a.btn.btn-outline-dark.w-100.py-2.mb-3(href="/auth/google")
                                i.bi.bi-google.me-2
                                | Đăng ký với Google
                            
                            .position-relative.my-4
                                hr
                                span.position-absolute.top-50.start-50.translate-middle.bg-white.px-3.small.text-muted hoặc
                            //- FORM 1: Nhập email và gửi OTP
                            form#form-request-otp.needs-validation(novalidate)
                                +authInput(
                                    'email',
                                    'email',
                                    'email',
                                    'Email',
                                    'envelope-fill',
                                    'your-email@example.com'
                                )
                                
                                .d-grid.mb-3
                                    button.btn.btn-success(type="submit")
                                        i.bi.bi-send-fill.me-2
                                        | Gửi mã OTP
                                
                                .text-center.small
                                    span.text-muted Đã có mã OTP? 
                                    a#show-verify-form.text-success.text-decoration-none(href="#")
                                        | Nhập ngay

                            //- FORM 2: Xác thực OTP và đăng ký (ẩn mặc định)
                            form#form-verify-register.d-none(action="/auth/register" method="POST" novalidate)
                                input(type="hidden" name="email")
                                
                                +authInput(
                                    'fullName',
                                    'fullName',
                                    'text',
                                    'Họ và tên',
                                    'person-fill',
                                    'Nguyễn Văn A',
                                    true,
                                    3
                                )
                                
                                .mb-3
                                    label.form-label.fw-medium(for="otp") Mã OTP
                                    .input-group
                                        span.input-group-text
                                            i.bi.bi-shield-check.text-success
                                        input#otp.form-control(
                                            type="text"
                                            name="otp"
                                            required
                                            maxlength="6"
                                            pattern="[0-9]{6}"
                                            placeholder="000000"
                                        )
                                        .invalid-feedback Vui lòng nhập mã OTP 6 số
                                
                                +authPasswordInput(
                                    'password',
                                    'password',
                                    'Mật khẩu',
                                    'lock-fill',
                                    '••••••••'
                                )
                                .form-text.small
                                    i.bi.bi-info-circle.me-1
                                    | Tối thiểu 6 ký tự
                                
                                +authPasswordInput(
                                    'confirmPassword',
                                    'confirmPassword',
                                    'Xác nhận mật khẩu',
                                    'shield-lock-fill',
                                    '••••••••'
                                )
                                
                                - 
                                    const termsLinks = [
                                        { text: 'Điều khoản dịch vụ', modal: true, target: '#termsModal' },
                                        { text: 'Chính sách bảo mật', modal: true, target: '#privacyModal' }
                                    ];
                                +authCheckbox(
                                    'acceptTerms',
                                    'acceptTerms',
                                    'Tôi đồng ý với',
                                    termsLinks
                                )
                                
                                +termsModal()
                                +privacyModal()
                                
                                .d-flex.gap-2.mb-3
                                    button#btn-back.btn.btn-outline-secondary.flex-grow-1(type="button")
                                        i.bi.bi-arrow-left.me-1
                                        | Quay lại
                                    button.btn.btn-success.flex-grow-1(type="submit")
                                        i.bi.bi-person-plus.me-1
                                        | Đăng ký
                            
                            .text-center.mt-4
                                .small.text-muted.mb-2 Đã có tài khoản?
                                a.text-decoration-none.text-success.fw-medium(href="/auth/login")
                                    i.bi.bi-box-arrow-in-right.me-1
                                    | Đăng nhập ngay
                            
                            hr.my-3
                            .text-center.small
                                a.text-decoration-none.text-secondary(href="/") 
                                    i.bi.bi-arrow-left.me-1
                                    | Về trang chủ