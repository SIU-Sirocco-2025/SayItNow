extends ../../layouts/auth.pug
include ../../mixins/alert.pug
include ../../mixins/auth-brand.pug

block main
  +showAlertSuccess(5000)
  +showAlertError(5000)

  .min-vh-100.d-flex.align-items-center.py-5
    .container
      .row.g-5.align-items-center
        //- Left brand / intro (giống login/register)
        .col-lg-6.order-2.order-lg-1
          -
            const features = [
              { icon: 'shield-lock', text: 'Bảo mật qua OTP gửi email' },
              { icon: 'envelope-paper', text: 'Xác minh nhanh chóng, an toàn' },
              { icon: 'person-check', text: 'Chỉ đổi mật khẩu khi xác thực đúng' }
            ];
            const buttons = [
              { class: 'btn btn-success btn-sm', href: '/', icon: 'house-door', text: 'Trang chủ' },
              { class: 'btn btn-outline-success btn-sm', href: '/aqi', icon: 'map', text: 'Xem bản đồ AQI' }
            ];
          +authBrandIntro(features, buttons)
            | Nhập email để nhận mã OTP và đặt lại mật khẩu của bạn.

        //- Right form card
        .col-lg-5.ms-lg-auto.order-1.order-lg-2
          .card.border-0.shadow-lg
            .card-body.p-4.p-md-5
              .text-center.mb-4
                +authLogo()
                  i.bi.bi-shield-lock-fill.fs-2.text-success
                h1.h5.mt-3.mb-1.fw-semibold.text-dark Quên mật khẩu
                p.small.text-secondary.mb-0 Khởi tạo lại mật khẩu bằng mã OTP gửi qua email đăng ký.

              // Step 1: Gửi OTP (khớp endpoint và field với script.js)
              form#form-request(action="/auth/forgot-password" method="POST" autocomplete="off" novalidate)
                .mb-3
                  label.form-label.fw-medium(for="email") Email đăng ký
                  .input-group
                    span.input-group-text
                      i.bi.bi-envelope-fill.text-success
                    input#email.form-control(
                      type="email"
                      name="email"
                      required
                      placeholder="your-email@example.com"
                    )
                .d-grid.mb-3
                  button.btn.btn-success(type="submit")
                    i.bi.bi-send-fill.me-2
                    | Gửi mã OTP
                .text-center.small
                  a.text-decoration-none(href="/auth/login")
                    i.bi.bi-arrow-left.me-1
                    | Về trang đăng nhập

              // Step 2: Xác minh OTP + đặt mật khẩu (ẩn ban đầu)
              form#form-verify.d-none(action="/auth/otp" method="POST" autocomplete="off" novalidate)
                //- script.js sẽ set giá trị cho hidden email này
                input(type="hidden" name="email")
                .mb-3
                  label.form-label.fw-medium(for="otp") Mã OTP
                  .input-group
                    span.input-group-text
                      i.bi.bi-key-fill.text-success
                    input#otp.form-control(
                      type="text"
                      name="otp"
                      minlength="6"
                      maxlength="6"
                      required
                      placeholder="6 ký tự"
                      pattern="\\d{6}"
                    )
                .mb-3
                  label.form-label.fw-medium(for="newPassword") Mật khẩu mới
                  .input-group
                    span.input-group-text
                      i.bi.bi-lock-fill.text-success
                    input#newPassword.form-control(
                      type="password"
                      name="password"
                      minlength="6"
                      required
                      placeholder="••••••••"
                    )
                .d-grid.mb-3
                  button.btn.btn-primary(type="submit")
                    i.bi.bi-check2-circle.me-2
                    | Xác nhận & Đổi mật khẩu
                .text-center.small
                  button#btn-back.btn.btn-link.text-decoration-none(type="button")
                    i.bi.bi-arrow-left.me-1
                    | Quay lại bước trước