doctype html
html(lang='vi')
  head
    meta(charset='UTF-8')
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
    title= title
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css')
    link(rel='stylesheet', href='https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap')
    link(rel='stylesheet', href='/client/css/docs.css')
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css')
    link(rel="icon" type="image/png" href="/client/image/logo.png" sizes="32x32") 
  body
    header.docs-header
      .container
        .header-content
          .logo
            i.fas.fa-leaf
            span Eco-Track API
          nav.header-nav
            a(href='/') Trang chủ
            a(href='/aqi') Bản đồ AQI
            a(href='/auth/settings') Cài đặt
            if currentUser
              span Hello, #{currentUser.fullName}
            else
              a.btn-primary(href='/auth/login') Đăng nhập
    
    .docs-layout
      aside.docs-sidebar
        .sidebar-content
          .sidebar-section
            h3 Bắt đầu
            ul
              li
                a(href='#introduction') Giới thiệu
              li
                a(href='#authentication') Xác thực API
              li
                a(href='#endpoints') Danh sách Endpoints
              li
                a(href='#errors') Xử lý lỗi
          
          .sidebar-section
            h3 API Endpoints
            ul
              li
                a(href='#compare') So sánh quận
              li
                a(href='#history') Lịch sử 72h
              li
                a(href='#by-datetime') Dữ liệu theo thời gian
              li
                a(href='#statistics') Thống kê
              li
                a(href='#trend') Xu hướng
              li
                a(href='#filter') Lọc dữ liệu
              li
                a(href='#export') Export dữ liệu
              li
                a(href='#hourly-average') Trung bình theo giờ
              li
                a(href='#latest') Dữ liệu mới nhất
          
          .sidebar-section
            h3 Prediction API
            ul
              li
                a(href='#prediction-intro') Giới thiệu
              li
                a(href='#prediction-get-data') Lấy dữ liệu 72h
              li
                a(href='#prediction-forecast') Dự đoán 24h
              li
                a(href='#prediction-districts') Danh sách quận
          
          .sidebar-section
            h3 Quản lý tài khoản
            ul
              li
                a(href='#get-api-key') Lấy API Key
              li
                a(href='#regenerate-api-key') Tạo lại API Key
          
          .sidebar-section
            h3 NGSI-LD API
            ul
              li
                a(href='#ngsi-ld-intro') Giới thiệu NGSI-LD
              li
                a(href='#ngsi-ld-context') Context
              li
                a(href='#ngsi-ld-entities') Query Entities
              li
                a(href='#ngsi-ld-temporal') Temporal Queries
              li
                a(href='#ngsi-ld-predictions') Predictions

      main.docs-main
        .docs-content
          section#introduction.docs-section
            h1 
              i.fas.fa-book
              |  API Documentation
            p.lead Chào mừng đến với Eco-Track API - nền tảng cung cấp dữ liệu chất lượng không khí thời gian thực và dự đoán AI cho TP.HCM
            
            p 
              | Eco-Track cung cấp 3 loại API chính:
            ul.api-types
              li
                strong REST API: 
                | Endpoints chuẩn REST để truy vấn dữ liệu AQI, thống kê, xu hướng
              li
                strong Prediction API: 
                | Dự đoán AQI 24h tới sử dụng mô hình LSTM (Long Short-Term Memory)
              li
                strong NGSI-LD API: 
                | Tuân thủ chuẩn Smart City ETSI cho IoT và Linked Data
            
            .info-box
              i.fas.fa-database
              div
                strong Dataset & Coverage:
                br
                | • 16 khu vực tại TP.HCM (thành phố + 15 quận/huyện)
                br
                | • Dữ liệu thu thập mỗi giờ từ OpenAQ API v3
                br
                | • 10+ features: AQI, PM2.5, PM10, O3, NO2, SO2, CO, weather
                br
                | • Hàng nghìn điểm dữ liệu mỗi ngày, lưu trữ dài hạn
            
            .info-box
              i.fas.fa-brain
              div
                strong AI Prediction Model:
                br
                | • Mô hình: LSTM (Long Short-Term Memory)
                br
                | • Input: 72 giờ dữ liệu lịch sử (AQI + weather)
                br
                | • Output: Dự đoán AQI cho 24 giờ tiếp theo
                br
                | • Độ chính xác: MAE 2-10 điểm, R² 0.85-0.95
                br
                | • Dataset huấn luyện: Dữ liệu thực từ các trạm quan trắc
            
            .info-box
              i.fas.fa-info-circle
              div
                strong API Version: 
                | v1.1
                br
                strong Base URL: 
                .base-url-selector.mt-2
                  label(for='baseUrlSelect') Chọn môi trường:
                  select#baseUrlSelect.form-select.d-inline-block.ms-2(style='width: auto;')
                    option(value='http://localhost:3000') Development (localhost:3000)
                    option(value='https://ecotrack.asia') Production (ecotrack.asia)
                  code#currentBaseUrl.ms-2 http://localhost:3000
          
          section#authentication.docs-section
            h2 
              i.fas.fa-key
              |  Xác thực API
            p Hầu hết các endpoint cần API key để truy cập. Có 3 cách để gửi API key:
            
            .auth-methods
              .auth-method
                h4 1. Header x-api-key
                .code-block
                  .code-header
                    span.language curl
                    button.copy-btn(onclick='copyCode(this)')
                      i.fas.fa-copy
                  pre
                    code.language-bash.
                      curl -H "x-api-key: YOUR_API_KEY" \
                        http://localhost:3000/aqi/history/quan1
              
              .auth-method
                h4 2. Authorization Bearer
                .code-block
                  .code-header
                    span.language curl
                    button.copy-btn(onclick='copyCode(this)')
                      i.fas.fa-copy
                  pre
                    code.language-bash.
                      curl -H "Authorization: Bearer YOUR_API_KEY" \
                        http://localhost:3000/aqi/history/quan1
              
              .auth-method
                h4 3. Query Parameter
                .code-block
                  .code-header
                    span.language curl
                    button.copy-btn(onclick='copyCode(this)')
                      i.fas.fa-copy
                  pre
                    code.language-bash.
                      curl http://localhost:3000/aqi/history/quan1?apiKey=YOUR_API_KEY
            
            .warning-box
              i.fas.fa-exclamation-triangle
              div
                strong Lưu ý: 
                | Không chia sẻ API key của bạn công khai. Bạn có thể tạo lại API key mới bất cứ lúc nào trong trang cài đặt.

          section#endpoints.docs-section
            h2 
              i.fas.fa-list
              |  Danh sách Endpoints
            
            .endpoint-grid
              .endpoint-card
                .endpoint-icon
                  i.fas.fa-balance-scale
                span.endpoint-name So sánh quận
                span.endpoint-path GET /aqi/compare
                span.endpoint-auth.no-auth Không cần auth
              
              .endpoint-card
                .endpoint-icon
                  i.fas.fa-history
                span.endpoint-name Lịch sử 72h
                span.endpoint-path GET /aqi/history/:cityKey
                span.endpoint-auth.auth-required Cần API key
              
              .endpoint-card
                .endpoint-icon
                  i.fas.fa-calendar-alt
                span.endpoint-name Theo thời gian
                span.endpoint-path GET /aqi/by-datetime/:cityKey
                span.endpoint-auth.auth-required Cần API key
              
              .endpoint-card
                .endpoint-icon
                  i.fas.fa-chart-bar
                span.endpoint-name Thống kê
                span.endpoint-path GET /aqi/statistics/:cityKey
                span.endpoint-auth.auth-required Cần API key
              
              .endpoint-card
                .endpoint-icon
                  i.fas.fa-chart-line
                span.endpoint-name Xu hướng
                span.endpoint-path GET /aqi/trend/:cityKey
                span.endpoint-auth.auth-required Cần API key
              
              .endpoint-card
                .endpoint-icon
                  i.fas.fa-filter
                span.endpoint-name Lọc dữ liệu
                span.endpoint-path GET /aqi/filter
                span.endpoint-auth.auth-required Cần API key
              
              .endpoint-card
                .endpoint-icon
                  i.fas.fa-download
                span.endpoint-name Export
                span.endpoint-path GET /aqi/export/:cityKey
                span.endpoint-auth.auth-required Cần API key
              
              .endpoint-card
                .endpoint-icon
                  i.fas.fa-clock
                span.endpoint-name Theo giờ
                span.endpoint-path GET /aqi/hourly-average/:cityKey
                span.endpoint-auth.auth-required Cần API key

          section#compare.docs-section
            h2 
              i.fas.fa-balance-scale
              |  So sánh AQI giữa các quận
            
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /aqi/compare
              span.auth-badge.no-auth Không cần API key
            
            p So sánh chất lượng không khí giữa tất cả các quận, tìm quận tốt nhất/xấu nhất.
            
            h4 Response Example
            .code-block
              .code-header
                span.language json
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-json.
                  {
                    "success": true,
                    "total": 15,
                    "statistics": {
                      "best": {
                        "city": "Quận 1",
                        "cityKey": "quan1",
                        "aqius": 45
                      },
                      "worst": {
                        "city": "Quận 10",
                        "aqius": 120
                      },
                      "average": 78.5
                    },
                    "districts": [...]
                  }

          section#history.docs-section
            h2 
              i.fas.fa-history
              |  Lịch sử AQI 72 giờ gần nhất
            
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /aqi/history/:cityKey
              span.auth-badge.auth Cần API key
            
            p Xem lịch sử dữ liệu AQI trong 72 giờ gần nhất (hoặc custom).
            
            h4 Parameters
            table.params-table
              thead
                tr
                  th Tên
                  th Kiểu
                  th Mô tả
              tbody
                tr
                  td
                    code cityKey
                  td Path
                  td Mã quận (quan1, quan2, hochiminhcity, thuduc...)
                tr
                  td
                    code limit
                  td Query
                  td Số lượng records (1-168), mặc định: 24
            
            h4 Request Example
            .code-block
              .code-header
                span.language curl
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-bash.
                  curl -H "x-api-key: YOUR_API_KEY" \
                    "http://localhost:3000/aqi/history/quan1?limit=72"
            
            h4 Response Example
            .code-block
              .code-header
                span.language json
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-json.
                  {
                    "city": "Quận 1",
                    "cityKey": "quan1",
                    "points": [
                      { "ts": "2025-11-23T10:00:00Z", "aqius": 65 },
                      { "ts": "2025-11-23T09:00:00Z", "aqius": 70 }
                    ]
                  }

          section#by-datetime.docs-section
            h2 
              i.fas.fa-calendar-alt
              |  Dữ liệu theo ngày giờ cụ thể
            
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /aqi/by-datetime/:cityKey
              span.auth-badge.auth Cần API key
            
            p Lấy dữ liệu AQI trong khoảng thời gian cụ thể.
            
            h4 Parameters
            table.params-table
              thead
                tr
                  th Tên
                  th Kiểu
                  th Mô tả
              tbody
                tr
                  td
                    code cityKey
                  td Path
                  td Mã quận
                tr
                  td
                    code startDate
                  td Query
                  td Ngày bắt đầu (ISO 8601)
                tr
                  td
                    code endDate
                  td Query
                  td Ngày kết thúc (ISO 8601)
            
            h4 Request Example
            .code-block
              .code-header
                span.language curl
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-bash.
                  curl -H "x-api-key: YOUR_API_KEY" \
                    "http://localhost:3000/aqi/by-datetime/quan1?startDate=2025-11-20&endDate=2025-11-22"

          section#statistics.docs-section
            h2 
              i.fas.fa-chart-bar
              |  Thống kê AQI
            
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /aqi/statistics/:cityKey
              span.auth-badge.auth Cần API key
            
            p Thống kê chi tiết: min, max, average, median, phân bố theo level.
            
            h4 Parameters
            table.params-table
              thead
                tr
                  th Tên
                  th Kiểu
                  th Mô tả
              tbody
                tr
                  td
                    code cityKey
                  td Path
                  td Mã quận
                tr
                  td
                    code hours
                  td Query
                  td Số giờ thống kê (1-168), mặc định: 24
            
            h4 Response Example
            .code-block
              .code-header
                span.language json
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-json.
                  {
                    "statistics": {
                      "min": { "value": 35 },
                      "max": { "value": 95 },
                      "average": { "value": 65 },
                      "median": { "value": 60 }
                    },
                    "distribution": {
                      "good": 12,
                      "moderate": 18
                    }
                  }

          section#trend.docs-section
            h2 
              i.fas.fa-chart-line
              |  Phân tích xu hướng
            
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /aqi/trend/:cityKey
              span.auth-badge.auth Cần API key
            
            p Phân tích xu hướng AQI đang tăng, giảm hay ổn định.
            
            h4 Response Example
            .code-block
              .code-header
                span.language json
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-json.
                  {
                    "trend": {
                      "direction": "decreasing",
                      "change": -15,
                      "changePercent": -18.75
                    },
                    "analysis": {
                      "increases": 3,
                      "decreases": 8
                    }
                  }

          section#filter.docs-section
            h2 
              i.fas.fa-filter
              |  Lọc dữ liệu nâng cao
            
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /aqi/filter
              span.auth-badge.auth Cần API key
            
            p Lọc dữ liệu theo AQI range, nhiệt độ, level.
            
            h4 Parameters
            table.params-table
              thead
                tr
                  th Tên
                  th Kiểu
                  th Mô tả
              tbody
                tr
                  td
                    code cityKey
                  td Query (required)
                  td Mã quận
                tr
                  td
                    code minAqi
                  td Query
                  td AQI tối thiểu
                tr
                  td
                    code maxAqi
                  td Query
                  td AQI tối đa
                tr
                  td
                    code level
                  td Query
                  td Level (good, moderate...)
                tr
                  td
                    code limit
                  td Query
                  td Số records, mặc định: 50

          section#export.docs-section
            h2 
              i.fas.fa-download
              |  Export dữ liệu
            
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /aqi/export/:cityKey
              span.auth-badge.auth Cần API key
            
            p Export dữ liệu ra định dạng CSV hoặc JSON.
            
            h4 Request Examples
            .code-block
              .code-header
                span.language bash
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-bash.
                  # Export CSV
                  curl -H "x-api-key: YOUR_API_KEY" \
                    "http://localhost:3000/aqi/export/quan1?format=csv" -o data.csv
                  
                  # Export JSON
                  curl -H "x-api-key: YOUR_API_KEY" \
                    "http://localhost:3000/aqi/export/quan1?format=json" -o data.json

          section#hourly-average.docs-section
            h2 
              i.fas.fa-clock
              |  Trung bình theo giờ
            
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /aqi/hourly-average/:cityKey
              span.auth-badge.auth Cần API key
            
            p Tính AQI trung bình cho từng giờ (0-23h).

          section#latest.docs-section
            h2 
              i.fas.fa-sync-alt
              |  Dữ liệu mới nhất
            
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /aqi/latest-reading
              span.auth-badge.no-auth Không cần API key
            
            p Lấy dữ liệu AQI mới nhất của TP.HCM.

          section#prediction-intro.docs-section
            h2 
              i.fas.fa-brain
              |  Prediction API - Dự đoán AQI bằng AI
            
            p Eco-Track sử dụng mô hình LSTM (Long Short-Term Memory) để dự đoán chỉ số AQI trong 24 giờ tới cho từng quận/huyện.
            
            .info-box
              i.fas.fa-info-circle
              div
                strong Về mô hình LSTM:
                br
                | LSTM là một loại mạng neural hồi quy (Recurrent Neural Network) đặc biệt hiệu quả trong việc học và dự đoán các chuỗi dữ liệu thời gian. Mô hình được huấn luyện trên dữ liệu lịch sử AQI từ OpenAQ API.
            
            h3 Đặc điểm mô hình
            ul.feature-list
              li
                strong Dataset huấn luyện: 
                | Dữ liệu AQI lịch sử thu thập liên tục mỗi giờ từ các trạm quan trắc OpenAQ
              li
                strong Input features (72 giờ gần nhất):
                ul
                  li AQI US (aqius) - Chỉ số chất lượng không khí chuẩn Mỹ
                  li Main pollutant (mainus) - Chất gây ô nhiễm chính (PM2.5, PM10, O3, NO2, SO2, CO)
                  li Nhiệt độ (tp), độ ẩm (hu), áp suất (pr)
                  li Tốc độ gió (ws), hướng gió (wd)
              li
                strong Output: 
                | 24 giá trị AQI dự đoán cho 24 giờ tiếp theo
              li
                strong Độ chính xác: 
                | MAE (Mean Absolute Error) từ 2-10 điểm AQI tùy quận
              li
                strong Hỗ trợ: 
                | 16 khu vực (TP.HCM + 15 quận/huyện)
            
            h3 Quy trình dự đoán
            ol.process-list
              li Lấy 72 giờ dữ liệu AQI gần nhất từ database
              li Chuẩn hóa dữ liệu theo scaler đã huấn luyện (min-max scaling)
              li Đưa vào mô hình LSTM với tham số từ file JSON tương ứng
              li Model xử lý và sinh 24 giá trị AQI dự đoán
              li Denormalize và trả về kết quả cho client
            
            .warning-box
              i.fas.fa-exclamation-triangle
              div
                strong Lưu ý: 
                | Prediction API yêu cầu ít nhất 72 giờ dữ liệu lịch sử trong database. Nếu thiếu dữ liệu, hãy chạy 
                code scripts/seed-72h-data.js
                |  hoặc 
                code scripts/fetch-openaq-hours.js
                |  để thu thập.

          section#prediction-get-data.docs-section
            h2 
              i.fas.fa-database
              |  Lấy dữ liệu 72 giờ cho prediction
            
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /api/prediction/get-72h-data/:district
              span.auth-badge.no-auth Không cần API key
            
            p Endpoint này trả về 72 giờ dữ liệu AQI gần nhất, được sử dụng làm input cho mô hình LSTM.
            
            h4 Parameters
            table.params-table
              thead
                tr
                  th Tên
                  th Kiểu
                  th Mô tả
              tbody
                tr
                  td
                    code district
                  td Path
                  td Mã quận (hcmc, district1, district2, binhThanh, thuDuc...)
            
            h4 Request Example
            .code-block
              .code-header
                span.language curl
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-bash.
                  curl http://localhost:3000/api/prediction/get-72h-data/district1
            
            h4 Response Example
            .code-block
              .code-header
                span.language json
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-json.
                  {
                    "success": true,
                    "district": "district1",
                    "count": 72,
                    "data": [
                      {
                        "timestamp": "2024-11-28T00:00:00.000Z",
                        "aqius": 95,
                        "aqicn": 65,
                        "mainus": "p2",
                        "maincn": "p2",
                        "temperature": 28,
                        "humidity": 75,
                        "pressure": 1010,
                        "windSpeed": 3.5,
                        "windDirection": 180
                      }
                    ]
                  }

          section#prediction-forecast.docs-section
            h2 
              i.fas.fa-crystal-ball
              |  Dự đoán AQI 24 giờ tới
            
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /api/prediction/forecast-24h/:district
              span.auth-badge.no-auth Không cần API key
            
            p Endpoint chính để lấy dự đoán AQI cho 24 giờ tiếp theo. Sử dụng mô hình LSTM đã được huấn luyện.
            
            h4 Parameters
            table.params-table
              thead
                tr
                  th Tên
                  th Kiểu
                  th Mô tả
              tbody
                tr
                  td
                    code district
                  td Path
                  td Mã quận (hcmc, district1, district2, binhThanh, thuDuc...)
            
            h4 Request Example
            .code-block
              .code-header
                span.language curl
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-bash.
                  curl http://localhost:3000/api/prediction/forecast-24h/district1
            
            h4 Response Example
            .code-block
              .code-header
                span.language json
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-json.
                  {
                    "success": true,
                    "district": "district1",
                    "timestamp": "2024-12-07T10:30:00.000Z",
                    "predictions": [
                      {
                        "hour": 1,
                        "timestamp": "2024-12-07T11:00:00.000Z",
                        "predictedAQI": 72,
                        "quality": "moderate"
                      },
                      {
                        "hour": 2,
                        "timestamp": "2024-12-07T12:00:00.000Z",
                        "predictedAQI": 68,
                        "quality": "moderate"
                      }
                    ],
                    "summary": {
                      "avgAQI": 65,
                      "maxAQI": 85,
                      "minAQI": 45,
                      "trend": "stable"
                    }
                  }
            
            h4 Quality Levels
            table.params-table
              thead
                tr
                  th AQI Range
                  th Level
                  th Màu
                  th Mô tả
              tbody
                tr
                  td 0-50
                  td Good
                  td 
                    span.badge(style='background: #00e400; color: white;') Xanh lá
                  td Chất lượng không khí tốt
                tr
                  td 51-100
                  td Moderate
                  td
                    span.badge(style='background: #ffff00; color: black;') Vàng
                  td Chấp nhận được
                tr
                  td 101-150
                  td Unhealthy for Sensitive
                  td
                    span.badge(style='background: #ff7e00; color: white;') Cam
                  td Nhạy cảm nên hạn chế ra ngoài
                tr
                  td 151-200
                  td Unhealthy
                  td
                    span.badge(style='background: #ff0000; color: white;') Đỏ
                  td Không tốt cho sức khỏe
                tr
                  td 201-300
                  td Very Unhealthy
                  td
                    span.badge(style='background: #8f3f97; color: white;') Tím
                  td Rất không tốt
                tr
                  td 301+
                  td Hazardous
                  td
                    span.badge(style='background: #7e0023; color: white;') Nâu đỏ
                  td Nguy hiểm

          section#prediction-districts.docs-section
            h2 
              i.fas.fa-map-marked-alt
              |  Danh sách Districts hỗ trợ Prediction
            
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /api/prediction/districts
              span.auth-badge.no-auth Không cần API key
            
            p Lấy danh sách tất cả các quận/huyện được hỗ trợ prediction.
            
            h4 Response Example
            .code-block
              .code-header
                span.language json
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-json.
                  {
                    "success": true,
                    "districts": [
                      { "key": "hcmc", "name": "TP. Hồ Chí Minh", "modelFile": "lstm_params_hcmc.json" },
                      { "key": "district1", "name": "Quận 1", "modelFile": "lstm_params_district_1.json" },
                      { "key": "district2", "name": "Quận 2", "modelFile": "lstm_params_district_2.json" },
                      { "key": "binhThanh", "name": "Bình Thạnh", "modelFile": "lstm_params_binh_thanh.json" },
                      { "key": "thuDuc", "name": "Thủ Đức", "modelFile": "lstm_params_thu_duc.json" }
                    ],
                    "total": 16
                  }
            
            h4 Supported Districts
            .city-keys-grid
              .city-key-item
                code hcmc
                span TP. Hồ Chí Minh
              .city-key-item
                code district1
                span Quận 1
              .city-key-item
                code district2
                span Quận 2
              .city-key-item
                code district3
                span Quận 3
              .city-key-item
                code district4
                span Quận 4
              .city-key-item
                code district5
                span Quận 5
              .city-key-item
                code district6
                span Quận 6
              .city-key-item
                code district7
                span Quận 7
              .city-key-item
                code district9
                span Quận 9
              .city-key-item
                code district10
                span Quận 10
              .city-key-item
                code district11
                span Quận 11
              .city-key-item
                code binhThanh
                span Bình Thạnh
              .city-key-item
                code phuNhuan
                span Phú Nhuận
              .city-key-item
                code tanPhu
                span Tân Phú
              .city-key-item
                code thuDuc
                span Thủ Đức

          section#get-api-key.docs-section
            h2 
              i.fas.fa-user-shield
              |  Quản lý API Key
            
            h3 Lấy API Key hiện tại
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /auth/api-key
              span.auth-badge.session Cần đăng nhập
            
            p Lấy thông tin API key của tài khoản đã đăng nhập.

          section#regenerate-api-key.docs-section
            h3 
              i.fas.fa-redo
              |  Tạo lại API Key mới
            
            .endpoint-info
              span.http-method.post POST
              code.endpoint-url /auth/api-key/regenerate
              span.auth-badge.session Cần đăng nhập
            
            p Tạo API key mới (key cũ sẽ không còn hoạt động).

          section#ngsi-ld-intro.docs-section
            h2 
              i.fas.fa-code-branch
              |  NGSI-LD API
            
            p Eco-Track cung cấp API tuân thủ chuẩn NGSI-LD (ETSI GS CIM 009) để tương thích với các hệ sinh thái Smart City.
            
            .info-box
              i.fas.fa-info-circle
              div
                strong NGSI-LD là gì?
                br
                | NGSI-LD là chuẩn API dựa trên Linked Data cho IoT và Smart Cities, sử dụng JSON-LD để biểu diễn dữ liệu có ngữ cảnh.
            
            .info-box
              i.fas.fa-database
              div
                strong AirQualityObserved
                br
                | Entity type mô tả một quan trắc chất lượng không khí. Các thuộc tính chính:
                ul
                  li
                    code dateObserved
                    |  - Thời điểm quan trắc (ISO 8601)
                  li
                    code airQualityIndex
                    |  - Chỉ số AQI tổng hợp
                  li
                    code pm25
                    |  - Nồng độ PM2.5 (µg/m³)
                  li
                    code pm10
                    |  - Nồng độ PM10 (µg/m³)
                  li
                    code o3
                    |  - Nồng độ O₃ (µg/m³)
                  li
                    code no2
                    |  - Nồng độ NO₂ (µg/m³)
                  li
                    code so2
                    |  - Nồng độ SO₂ (µg/m³)
                  li
                    code co
                    |  - Nồng độ CO (µg/m³)
          
          section#ngsi-ld-context.docs-section
            h2 
              i.fas.fa-link
              |  Context Definition
             
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /api/ngsi-ld/context
             
            p
              | Lấy @context định nghĩa cho tất cả entities của Eco-Track. Ngoài endpoint động ở 
              code /api/ngsi-ld/context
              | , hệ thống cũng phục vụ context tĩnh tại 
              code /context
              |  (xem 
              a(href='/public/context.jsonld') public/context.jsonld
              | ). Cấu hình prefix API xem 
              a(href='/config/system.js') 
                | `
                | config.system.prefixAPI
                | `
              | .
          
            h4 Response Example
            .code-block
              .code-header
                span.language json
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-json.
                  {
                    "@context": {
                      "ngsi-ld": "https://uri.etsi.org/ngsi-ld/",
                      "schema": "https://schema.org/",
                      "ecotrack": "https://ecotrack.asia/entities/",
                      "id": "@id",
                      "type": "@type",
                      "AirQualityObserved": "ecotrack:AirQualityObserved",
                      "dateObserved": {
                        "@id": "schema:observationDate",
                        "@type": "DateTime"
                      },
                      "airQualityIndex": {
                        "@id": "ecotrack:airQualityIndex",
                        "@type": "ngsi-ld:Property"
                      },
                      "pm25": { "@id": "ecotrack:pm25", "@type": "ngsi-ld:Property" },
                      "pm10": { "@id": "ecotrack:pm10", "@type": "ngsi-ld:Property" },
                      "o3": { "@id": "ecotrack:o3", "@type": "ngsi-ld:Property" },
                      "no2": { "@id": "ecotrack:no2", "@type": "ngsi-ld:Property" },
                      "so2": { "@id": "ecotrack:so2", "@type": "ngsi-ld:Property" },
                      "co": { "@id": "ecotrack:co", "@type": "ngsi-ld:Property" },
                      "location": { "@id": "schema:geo", "@type": "ngsi-ld:GeoProperty" }
                    }
                  }
          
          section#ngsi-ld-entities.docs-section
            h2 
              i.fas.fa-database
              |  Query Entities
             
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /api/ngsi-ld/entities/:district
             
            p Lấy entity mới nhất theo chuẩn NGSI-LD cho một quận (type: 
              code AirQualityObserved
              | ).
             
            h4 Request Example
            .code-block
              .code-header
                span.language bash
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-bash.
                  curl -X GET "https://ecotrack.asia/api/ngsi-ld/entities/district1" \
                    -H "Accept: application/ld+json"
             
            h4 Response Example
            .code-block
              .code-header
                span.language json
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-json.
                  {
                    "@context": "https://ecotrack.asia/context",
                    "id": "urn:ngsi-ld:AirQualityObserved:district1:1735574400000",
                    "type": "AirQualityObserved",
                    "dateObserved": {
                      "type": "Property",
                      "value": "2024-12-30T12:00:00Z"
                    },
                    "airQualityIndex": {
                      "type": "Property",
                      "value": 75
                    },
                    "pm25": { "type": "Property", "value": 23.4 },
                    "pm10": { "type": "Property", "value": 41.2 },
                    "o3": { "type": "Property", "value": 68.1 },
                    "no2": { "type": "Property", "value": 21.9 },
                    "so2": { "type": "Property", "value": 7.3 },
                    "co": { "type": "Property", "value": 0.5 },
                    "location": {
                      "type": "GeoProperty",
                      "value": {
                        "type": "Point",
                        "coordinates": [106.7009, 10.7756]
                      }
                    }
                  }
          
          section#ngsi-ld-temporal.docs-section
            h2 
              i.fas.fa-clock
              |  Temporal Queries
            
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /api/ngsi-ld/entities/:district/temporal
            
            p Truy vấn dữ liệu 
              code AirQualityObserved
              |  theo khoảng thời gian (dateObserved).
            
            h4 Parameters
            table.param-table
              thead
                tr
                  th Tham số
                  th Loại
                  th Mô tả
              tbody
                tr
                  td
                    code timeAt
                  td Query
                  td Thời gian bắt đầu (ISO 8601)
                tr
                  td
                    code endTimeAt
                  td Query
                  td Thời gian kết thúc (ISO 8601)
                tr
                  td
                    code limit
                  td Query
                  td Số lượng records (mặc định: 24)
            
            h4 Request Example
            .code-block
              .code-header
                span.language bash
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-bash.
                  curl -X GET "https://ecotrack.asia/api/ngsi-ld/entities/district1/temporal?timeAt=2024-12-30T00:00:00Z&endTimeAt=2024-12-30T23:59:59Z&limit=24" \
                    -H "Accept: application/ld+json"

          section#ngsi-ld-predictions.docs-section
            h2
              i.fas.fa-brain
              |  Predictions
            .endpoint-info
              span.http-method.get GET
              code.endpoint-url /api/ngsi-ld/predictions/:district
            p Trả về dự báo AQI 24h ở định dạng NGSI-LD Collection, mỗi phần tử là một entity AQIPrediction.
            h4 Request Example
            .code-block
              .code-header
                span.language bash
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-bash.
                  curl -X GET "http://localhost:3000/api/ngsi-ld/predictions/district1" \
                    -H "Accept: application/ld+json"
            h4 Response Example
            .code-block
              .code-header
                span.language json
                button.copy-btn(onclick='copyCode(this)')
                  i.fas.fa-copy
              pre
                code.language-json.
                  {
                    "@context": "https://ecotrack.asia/context/v1",
                    "type": "Collection",
                    "totalItems": 24,
                    "member": [
                      {
                        "@context": "https://ecotrack.asia/context/v1",
                        "id": "urn:ngsi-ld:AQIPrediction:district1:1",
                        "type": "AQIPrediction",
                        "predictedAQI": { "type": "Property", "value": 72, "observedAt": "2025-12-04T10:00:00Z" },
                        "predictionHour": { "type": "Property", "value": 1 },
                        "quality": { "type": "Property", "value": "moderate" },
                        "timestamp": { "type": "Property", "value": "2025-12-04T11:00:00Z" },
                        "district": { "type": "Relationship", "object": "urn:ngsi-ld:District:district1" }
                      }
                    ]
                  }

          section#errors.docs-section
            h2 
              i.fas.fa-exclamation-circle
              |  Xử lý lỗi
            
            p API sử dụng các HTTP status code chuẩn:
            
            table.params-table
              thead
                tr
                  th Status Code
                  th Ý nghĩa
              tbody
                tr
                  td
                    code 200
                  td OK - Request thành công
                tr
                  td
                    code 400
                  td Bad Request
                tr
                  td
                    code 401
                  td Unauthorized - Thiếu API key
                tr
                  td
                    code 403
                  td Forbidden - API key không hợp lệ
                tr
                  td
                    code 404
                  td Not Found
                tr
                  td
                    code 500
                  td Internal Server Error

          section.docs-section
            h2 
              i.fas.fa-map-marked-alt
              |  Danh sách City Keys
            
            p Các cityKey hợp lệ:
            
            .city-keys-grid
              .city-key-item
                code hochiminhcity
                span TP. Hồ Chí Minh
              .city-key-item
                code quan1
                span Quận 1
              .city-key-item
                code quan2
                span Quận 2
              .city-key-item
                code quan3
                span Quận 3
              .city-key-item
                code quan4
                span Quận 4
              .city-key-item
                code quan5
                span Quận 5
              .city-key-item
                code quan6
                span Quận 6
              .city-key-item
                code quan7
                span Quận 7
              .city-key-item
                code quan9
                span Quận 9
              .city-key-item
                code quan10
                span Quận 10
              .city-key-item
                code quan11
                span Quận 11
              .city-key-item
                code thuduc
                span Thủ Đức

    footer.docs-footer
      .container
        p &copy; 2025 Eco-Track. All rights reserved.
        .footer-links
          a(href='/') Trang chủ
          a(href='/aqi') Bản đồ
          a(href='/api/docs') API Docs

    script(src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js')
    script(src='/client/js/docs.js')
